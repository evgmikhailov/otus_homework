#Домашнее задание 05 

Выполенено в виде ansible плейбук 
https://github.com/evgmikhailov/otus_homework/tree/main/otus_hw05

роли:
BASE - установвка основных компонентов и обнолвение
nfs_server - установка NFS сервера (сервевер ubt02)
nfs_cliens - устанвока NFS клиетов (сервер ubt01)
nfs_verify - проверка работоспособности 

Листинг работы ниже:
user01@ubt03:~/otus_hw05$ ansible-playbook  --become --ask-become-pass --vault-id @prompt site.yml
SSH password:
BECOME password[defaults to SSH password]:
Vault password (default):

PLAY [all] ***********************************************************************************************************************************************

TASK [Gathering Facts] ***********************************************************************************************************************************
ok: [ubt02]
ok: [ubt01]

TASK [base : Create ansible user] ************************************************************************************************************************
ok: [ubt02]
ok: [ubt01]

TASK [base : Add ssh key for ansible] ********************************************************************************************************************
ok: [ubt02]
ok: [ubt01]

TASK [base : Add sudoers file for ansible] ***************************************************************************************************************
ok: [ubt01]
ok: [ubt02]

TASK [base : Generate sshd_config file from template] ****************************************************************************************************
ok: [ubt02]
ok: [ubt01]

TASK [base : Update and upgrade apt packages] ************************************************************************************************************
ok: [ubt02]

ok: [ubt01]

TASK [base : Set TimeZone] *******************************************************************************************************************************
ok: [ubt01]
ok: [ubt02]

TASK [base : Install sshpass] ****************************************************************************************************************************
ok: [ubt02]
ok: [ubt01]

PLAY [nfs_server] ****************************************************************************************************************************************

TASK [Gathering Facts] ***********************************************************************************************************************************
ok: [ubt02]

TASK [nfs_server : Install NFS server packages] **********************************************************************************************************

ok: [ubt02]

TASK [nfs_server : Create NFS share directory] ***********************************************************************************************************
ok: [ubt02]

TASK [nfs_server : Configure NFS exports] ****************************************************************************************************************
ok: [ubt02]

TASK [nfs_server : Reload NFS exports] *******************************************************************************************************************
changed: [ubt02]

TASK [nfs_server : Verify NFS exports] *******************************************************************************************************************
ok: [ubt02]

TASK [nfs_server : Show NFS exports] *********************************************************************************************************************
ok: [ubt02] => {
    "nfs_exports_1.stdout_lines": [
        "/nfs/share  192.168.1.151/32(sync,wdelay,hide,no_subtree_check,sec=sys,rw,secure,root_squash,no_all_squash)"
    ]
}

TASK [nfs_server : Create test file check_file] **********************************************************************************************************
changed: [ubt02]

TASK [nfs_server : Ensure NFS services are enabled and running] ******************************************************************************************
ok: [ubt02] => (item=rpcbind)
ok: [ubt02] => (item=nfs-server)

TASK [nfs_server : Reboot NFS server] ********************************************************************************************************************
changed: [ubt02]

PLAY [nfs_clients] ***************************************************************************************************************************************

TASK [Gathering Facts] ***********************************************************************************************************************************
ok: [ubt01]

TASK [nfs_clients : Install NFS client packages] *********************************************************************************************************
ok: [ubt01]

TASK [nfs_clients : Create mount point directory] ********************************************************************************************************
ok: [ubt01]

TASK [nfs_clients : Configure NFS mount in fstab] ********************************************************************************************************
ok: [ubt01]

TASK [nfs_clients : Reload systemd] **********************************************************************************************************************
changed: [ubt01]

TASK [nfs_clients : Restart remote-fs target] ************************************************************************************************************
changed: [ubt01]

TASK [nfs_clients : Verify NFS mount] ********************************************************************************************************************
ok: [ubt01]

TASK [nfs_clients : Reboot client] ***********************************************************************************************************************
changed: [ubt01]

TASK [nfs_clients : Create test file client_file] ********************************************************************************************************
changed: [ubt01]

PLAY [all] ***********************************************************************************************************************************************

TASK [Gathering Facts] ***********************************************************************************************************************************
ok: [ubt02]
ok: [ubt01]

TASK [nfs_verify : Check files on server] ****************************************************************************************************************
skipping: [ubt01]
ok: [ubt02]

TASK [nfs_verify : Display files on server] **************************************************************************************************************
ok: [ubt02] => {
    "server_files.stdout_lines": [
        "check_file",
        "client_file"
    ]
}
skipping: [ubt01]

TASK [nfs_verify : Check NFS exports] ********************************************************************************************************************
skipping: [ubt01]
ok: [ubt02]

TASK [nfs_verify : Display NFS exports] ******************************************************************************************************************
ok: [ubt02] => {
    "nfs_exports.stdout": "/nfs/share  192.168.1.151/32(sync,wdelay,hide,no_subtree_check,sec=sys,rw,secure,root_squash,no_all_squash)"
}
skipping: [ubt01]

TASK [nfs_verify : Check RPC mounts] *********************************************************************************************************************
skipping: [ubt01]
ok: [ubt02]

TASK [nfs_verify : Display RPC mounts] *******************************************************************************************************************
ok: [ubt02] => {
    "rpc_mounts.stdout": "All mount points on 192.168.1.122:\n192.168.1.151:/nfs/share"
}
skipping: [ubt01]

TASK [nfs_verify : Check RPC on client] ******************************************************************************************************************
skipping: [ubt02]
ok: [ubt01]

TASK [nfs_verify : Display RPC info on client] ***********************************************************************************************************
skipping: [ubt02]
ok: [ubt01] => {
    "client_rpc.stdout": "All mount points on 192.168.1.122:\n192.168.1.151:/nfs/share"
}

TASK [nfs_verify : Check mount status] *******************************************************************************************************************
skipping: [ubt02]
ok: [ubt01]

TASK [nfs_verify : Display mount status] *****************************************************************************************************************
skipping: [ubt02]
ok: [ubt01] => {
    "mount_status.stdout": "systemd-1 /mnt autofs rw,relatime,fd=64,pgrp=1,timeout=0,minproto=5,maxproto=5,direct,pipe_ino=4681 0 0\n192.168.1.122:/nfs/share /mnt nfs rw,relatime,vers=3,rsize=262144,wsize=262144,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,mountaddr=192.168.1.122,mountvers=3,mountport=48773,mountproto=udp,local_lock=none,addr=192.168.1.122 0 0"
}

TASK [nfs_verify : Check existing files in NFS share] ****************************************************************************************************
skipping: [ubt02]
ok: [ubt01]

TASK [nfs_verify : Display existing files] ***************************************************************************************************************
skipping: [ubt02]
ok: [ubt01] => {
    "existing_files.stdout_lines": [
        "check_file",
        "client_file"
    ]
}

TASK [nfs_verify : Create test file] *********************************************************************************************************************
skipping: [ubt02]
changed: [ubt01]

TASK [nfs_verify : Verify test file] *********************************************************************************************************************
skipping: [ubt02]
ok: [ubt01]

TASK [nfs_verify : Display test file status] *************************************************************************************************************
skipping: [ubt02]
ok: [ubt01] => {
    "test_file.stat.exists": true
}

PLAY RECAP ***********************************************************************************************************************************************
ubt01                      : ok=27   changed=5    unreachable=0    failed=0    skipped=6    rescued=0    ignored=0
ubt02                      : ok=25   changed=3    unreachable=0    failed=0    skipped=9    rescued=0    ignored=0

user01@ubt03:~/otus_hw05$
